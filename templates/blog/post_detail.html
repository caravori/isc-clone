{% extends 'base.html' %}

{% block title %}{{ post.title }} - {{ site_settings.site_name }}{% endblock %}

{% block extra_css %}
<style>
    .post-content { line-height: 1.8; }
    .post-content h2, .post-content h3 { margin-top: 2rem; margin-bottom: 1rem; color: #1e3a8a; }
    .post-content p { margin-bottom: 1rem; }
    .post-content ul, .post-content ol { margin-left: 2rem; margin-bottom: 1rem; }
    .post-content code { background: #f3f4f6; padding: 0.2rem 0.4rem; border-radius: 3px; font-family: monospace; }
    .post-content pre { background: #1f2937; color: #f3f4f6; padding: 1rem; border-radius: 4px; overflow-x: auto; }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <h1 style="color: #1e3a8a; margin-bottom: 1rem;">{{ post.title }}</h1>
    
    <div class="text-muted" style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid #e5e7eb;">
        <strong>Author:</strong> {{ post.author.get_full_name|default:post.author.username }} |
        <strong>Published:</strong> {{ post.published_date|date:"F d, Y H:i" }} |
        {% if post.category %}
        <strong>Category:</strong> <a href="{% url 'blog:category' post.category.slug %}" style="color: #3b82f6;">{{ post.category.name }}</a> |
        {% endif %}
        <strong>Views:</strong> {{ post.views_count }}
    </div>
    
    {% if post.tags.all %}
    <div style="margin-bottom: 1.5rem;">
        <strong>Tags:</strong>
        {% for tag in post.tags.all %}
        <a href="{% url 'blog:tag' tag.slug %}" style="background: #dbeafe; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.9rem; text-decoration: none; color: #1e40af; margin-right: 0.5rem;">
            {{ tag.name }}
        </a>
        {% endfor %}
    </div>
    {% endif %}
    
    <div class="post-content">
        {{ post.content|safe }}
    </div>
    
    {% if ISSN_NUMBER %}
    <div style="margin-top: 2rem; padding: 1rem; background: #f3f4f6; border-left: 4px solid #3b82f6; font-size: 0.9rem;">
        <strong>Citation:</strong> {{ post.author.get_full_name|default:post.author.username }}. ({{ post.published_date|date:"Y, F d" }}). {{ post.title }}. <em>{{ site_settings.site_name }}</em>. ISSN {{ ISSN_NUMBER }}.
    </div>
    {% endif %}
</div>

{% if post.threat_indicators.all %}
<div class="card">
    <h3>Related Threat Indicators</h3>
    <ul style="margin-left: 2rem;">
        {% for indicator in post.threat_indicators.all %}
        <li>
            <strong>{{ indicator.get_indicator_type_display }}:</strong> {{ indicator.value|truncatewords:10 }}
            <span style="background: {% if indicator.severity == 'critical' %}#ef4444{% elif indicator.severity == 'high' %}#f97316{% elif indicator.severity == 'medium' %}#f59e0b{% else %}#10b981{% endif %}; color: white; padding: 0.1rem 0.4rem; border-radius: 3px; font-size: 0.75rem; margin-left: 0.5rem;">
                {{ indicator.severity|upper }}
            </span>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

{% if comments %}
<div class="card">
    <h3>Comments ({{ comments.count }})</h3>
    {% for comment in comments %}
    <div style="border-left: 3px solid #e5e7eb; padding-left: 1rem; margin-top: 1rem;">
        <div style="font-weight: bold;">{{ comment.author_name }}</div>
        <div style="font-size: 0.85rem; color: #6b7280; margin-bottom: 0.5rem;">{{ comment.created_date|date:"F d, Y H:i" }}</div>
        <p>{{ comment.content }}</p>
    </div>
    {% endfor %}
</div>
{% endif %}

<div style="margin-top: 2rem;">
    <a href="{% url 'blog:post_list' %}" class="btn" style="background: #6b7280;">&larr; Back to Posts</a>
</div>
{% endblock %}
