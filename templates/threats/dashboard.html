{% extends 'base.html' %}

{% block title %}Threat Intelligence Dashboard - {{ site_settings.site_name }}{% endblock %}

{% block content %}
<div class="card">
    <h2>Threat Intelligence Dashboard</h2>
    <p>Real-time security monitoring and threat analysis.</p>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
    <div class="card" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white;">
        <h3 style="color: white;">Ports Monitored</h3>
        <div style="font-size: 2.5rem; font-weight: bold;">{{ stats.total_ports_monitored }}</div>
    </div>
    <div class="card" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white;">
        <h3 style="color: white;">Malicious IPs</h3>
        <div style="font-size: 2.5rem; font-weight: bold;">{{ stats.malicious_ips }}</div>
    </div>
    <div class="card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;">
        <h3 style="color: white;">Active Indicators</h3>
        <div style="font-size: 2.5rem; font-weight: bold;">{{ stats.active_indicators }}</div>
    </div>
    <div class="card" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color: white;">
        <h3 style="color: white;">High Risk Ports</h3>
        <div style="font-size: 2.5rem; font-weight: bold;">{{ stats.high_risk_ports }}</div>
    </div>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
    <div class="card">
        <h3>Top Scanned Ports</h3>
        <table style="width: 100%; margin-top: 1rem;">
            <thead>
                <tr style="border-bottom: 2px solid #e5e7eb;">
                    <th style="padding: 0.5rem; text-align: left;">Port</th>
                    <th style="padding: 0.5rem; text-align: left;">Service</th>
                    <th style="padding: 0.5rem; text-align: center;">Scans</th>
                    <th style="padding: 0.5rem; text-align: center;">Risk</th>
                </tr>
            </thead>
            <tbody>
                {% for port in top_ports %}
                <tr style="border-bottom: 1px solid #f3f4f6;">
                    <td style="padding: 0.5rem;"><strong>{{ port.port_number }}/{{ port.protocol }}</strong></td>
                    <td style="padding: 0.5rem;">{{ port.service_name|default:"Unknown" }}</td>
                    <td style="padding: 0.5rem; text-align: center;">{{ port.scan_count }}</td>
                    <td style="padding: 0.5rem; text-align: center;">
                        <span style="padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.85rem; background: {% if port.risk_level == 'critical' %}#fee2e2; color: #991b1b{% elif port.risk_level == 'high' %}#fed7aa; color: #9a3412{% elif port.risk_level == 'medium' %}#fef3c7; color: #92400e{% else %}#d1fae5; color: #065f46{% endif %};">
                            {{ port.risk_level|upper }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div style="text-align: center; margin-top: 1rem;">
            <a href="{% url 'threats:ports' %}" class="btn">View All Ports</a>
        </div>
    </div>
    
    <div class="card">
        <h3>Recent Malicious IPs</h3>
        <table style="width: 100%; margin-top: 1rem;">
            <thead>
                <tr style="border-bottom: 2px solid #e5e7eb;">
                    <th style="padding: 0.5rem; text-align: left;">IP Address</th>
                    <th style="padding: 0.5rem; text-align: center;">Country</th>
                    <th style="padding: 0.5rem; text-align: center;">Reports</th>
                </tr>
            </thead>
            <tbody>
                {% for ip in malicious_ips %}
                <tr style="border-bottom: 1px solid #f3f4f6;">
                    <td style="padding: 0.5rem; font-family: monospace;">{{ ip.ip_address }}</td>
                    <td style="padding: 0.5rem; text-align: center;">{{ ip.country|default:"-" }}</td>
                    <td style="padding: 0.5rem; text-align: center;"><strong>{{ ip.reports_count }}</strong></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div style="text-align: center; margin-top: 1rem;">
            <a href="{% url 'threats:ips' %}" class="btn">View All IPs</a>
        </div>
    </div>
</div>

<div class="card" style="margin-top: 1.5rem;">
    <h3>Active Threat Indicators</h3>
    <table style="width: 100%; margin-top: 1rem;">
        <thead>
            <tr style="border-bottom: 2px solid #e5e7eb;">
                <th style="padding: 0.5rem; text-align: left;">Type</th>
                <th style="padding: 0.5rem; text-align: left;">Indicator</th>
                <th style="padding: 0.5rem; text-align: center;">Severity</th>
                <th style="padding: 0.5rem; text-align: left;">Added</th>
            </tr>
        </thead>
        <tbody>
            {% for indicator in active_indicators %}
            <tr style="border-bottom: 1px solid #f3f4f6;">
                <td style="padding: 0.5rem;"><strong>{{ indicator.get_indicator_type_display }}</strong></td>
                <td style="padding: 0.5rem; font-family: monospace; font-size: 0.9rem;">{{ indicator.value|truncatewords:8 }}</td>
                <td style="padding: 0.5rem; text-align: center;">
                    <span style="padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.85rem; background: {% if indicator.severity == 'critical' %}#fee2e2; color: #991b1b{% elif indicator.severity == 'high' %}#fed7aa; color: #9a3412{% elif indicator.severity == 'medium' %}#fef3c7; color: #92400e{% else %}#d1fae5; color: #065f46{% endif %};">
                        {{ indicator.severity|upper }}
                    </span>
                </td>
                <td style="padding: 0.5rem; font-size: 0.9rem;">{{ indicator.added_date|date:"M d, Y" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div style="text-align: center; margin-top: 1rem;">
        <a href="{% url 'threats:indicators' %}" class="btn">View All Indicators</a>
    </div>
</div>
{% endblock %}
