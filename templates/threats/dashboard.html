{% extends 'base.html' %}

{% block title %}Threat Intelligence - {{ block.super }}{% endblock %}

{% block content %}
<div class="card">
    <h2>Threat Intelligence Dashboard</h2>
    <p>Monitor current cybersecurity threat levels and historical data.</p>
</div>

{% if current_threat %}
<div class="card">
    <h2>Current InfoCon Level: <span style="color: {% if current_threat.level == 'green' %}#10b981{% elif current_threat.level == 'yellow' %}#f59e0b{% elif current_threat.level == 'orange' %}#f97316{% else %}#ef4444{% endif %};">{{ current_threat.get_level_display|upper }}</span></h2>
    <p><strong>Set at:</strong> {{ current_threat.set_at|date:"F j, Y, g:i a" }}</p>
    <p>{{ current_threat.description }}</p>
</div>
{% else %}
<div class="card">
    <p class="text-muted">No threat level set. Configure in the <a href="/admin/threats/threatlevel/">admin panel</a>.</p>
</div>
{% endif %}

{% if threat_history %}
<div class="card">
    <h2>Threat Level History</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 2px solid #e5e7eb;">
                <th style="text-align: left; padding: 0.5rem;">Date</th>
                <th style="text-align: left; padding: 0.5rem;">Level</th>
                <th style="text-align: left; padding: 0.5rem;">Description</th>
            </tr>
        </thead>
        <tbody>
            {% for threat in threat_history %}
            <tr style="border-bottom: 1px solid #e5e7eb;">
                <td style="padding: 0.5rem;">{{ threat.set_at|date:"Y-m-d H:i" }}</td>
                <td style="padding: 0.5rem;">
                    <span style="color: {% if threat.level == 'green' %}#10b981{% elif threat.level == 'yellow' %}#f59e0b{% elif threat.level == 'orange' %}#f97316{% else %}#ef4444{% endif %}; font-weight: bold;">
                        {{ threat.get_level_display|upper }}
                    </span>
                </td>
                <td style="padding: 0.5rem;">{{ threat.description|truncatewords:20 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}
